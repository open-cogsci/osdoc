title: Notes de version pour 4.0.0
hash: 494ece6e7922aaccd54fd8a5e6ecd2fbb4ef41e2a3509186ca0bf1c9aac01c84
locale: fr
language: French

OpenSesame 4.0 *Melodramatic Milgram* est une nouvelle version majeure avec de nombreuses nouvelles fonctionnalités et améliorations.


[TOC]

## Important : Changements incompatibles avec les versions précédentes

- La journalisation des variables a légèrement changé. Plus précisément, les variables définies dans l'interface utilisateur, telles que les colonnes d'un tableau `loop` ou les variables explicitement sélectionnées dans un `logger`, sont toujours enregistrées. Les variables définies dans un `inline_script` ou `inline_javascript` sont enregistrées uniquement si elles sont des nombres (`int` et `float`), des chaînes (`str` et `bytes`) et des valeurs `None`. Cela permet d'éviter que les fichiers de journalisation ne deviennent déraisonnablement volumineux en raison de l'enregistrement de longues listes et d'autres grandes valeurs.
- Le contenu des balises `<script>` dans les éléments `inline_html` n'est pas évalué. Cela n'est plus nécessaire, car vous pouvez simplement vous référer aux variables expérimentales comme vous le feriez ailleurs en JavaScript (voir ci-dessous).
- Les expressions conditionnelles ne sont interprétées comme script OpenSesame que si elles contiennent des références de variables à l'aide de la notation entre crochets ou des mots "always" ou "never". Sinon, elles sont interprétées comme des expressions Python comme décrit ci-dessous.

## Nouveau module Python OpenSesame (sans interface graphique)

Pour ceux d'entre vous qui préfèrent coder plutôt que d'utiliser une interface graphique : vous pouvez désormais utiliser OpenSesame en tant que module Python.

```python
from libopensesame.python_workspace_api import \
  Experiment, Canvas, Keyboard, Text

# Initialisez la fenêtre d'expérience en utilisant le backend "legacy"
exp, win, clock, log = Experiment(canvas_backend='legacy')
# Préparez un canevas de stimulus et un clavier
cnv = Canvas()
cnv += Text('Bonjour le monde')
kb = Keyboard()
# Affichez le canevas, attendez un appui sur une touche, puis terminez l'expérience
cnv.show()
kb.get_key()
exp.end()
```

Voir aussi :

- %link:manual/python/nogui%

## Amélioration de l'intégration avec Python et JavaScript

L'intégration entre OpenSesame et Python (sur le bureau) / JavaScript (dans le navigateur) est maintenant plus intuitive. Plus précisément, la syntaxe spécifique à OpenSesame a été en partie remplacée par une syntaxe Python/JavaScript standard, et il n'y a plus de distinction entre les variables expérimentales et les variables globales en Python/JavaScript.

### {} au lieu de [] : prise en charge des chaînes de caractères formatées (f-strings)

La notation préférée pour faire référence aux variables dans l'interface utilisateur est maintenant avec des accolades (`{my_var}`), plutôt qu'avec des crochets (`[my_var]`).

Vous pouvez même inclure des expressions Python complètes entre les accolades. Par exemple, le texte suivant sur un SKETCHPAD inclura le texte "Bien joué !" si la précision est supérieure à 70% et le texte "Essayez plus fort !" sinon.

```text
Votre précision est de {acc} %. {'Bien joué !' if acc > 70 else 'Essayez plus fort !'}
```

Lors de l'exécution d'une expérience avec OSWeb dans un navigateur, le code Python à l'intérieur des accolades est automatiquement converti en JavaScript. Cela signifie que vous pouvez utiliser les mêmes expressions Python à l'intérieur des accolades sur le bureau et dans un navigateur.

Pour plus d'informations, consultez :

- <https://docs.python.org/3/reference/lexical_analysis.html#f-strings>

### Prise en charge des expressions conditionnelles de style Python

La syntaxe préférée pour les expressions run-if, break-if, show-if et autres expressions conditionnelles est Python, plutôt que le script OpenSesame. Cela signifie que l'expression run-if suivante fait en sorte que l'élément ne soit exécuté que lorsque la variable `correct` est égale à 1, c'est-à-dire après une réponse correcte. (Cela est également lié au fait que les variables expérimentales sont maintenant des globales, voir ci-dessous.)

```python
correct == 1
```

Lors de l'exécution d'une expérience avec OSWeb dans un navigateur, les expressions conditionnelles Python sont automatiquement converties en JavaScript. Cela signifie que vous pouvez utiliser les mêmes expressions run-if, break-if, show-if et autres expressions conditionnelles Python sur le bureau et dans un navigateur.

### Espace de travail JavaScript persistant

L'espace de travail JavaScript est maintenant persistant. Cela signifie que vous pouvez définir une fonction ou une variable dans un `inline_javascript` puis vous y référer dans un autre `inline_javascript`.

### Les variables expérimentales sont globales

Les variables expérimentales, telles que `response_time` et les variables définies dans les éléments LOOP, sont désormais des variables globales au sein de Python et JavaScript. Cela signifie que vous n'avez plus à utiliser l'objet `var` (Python) ou `vars`, mais pouvez directement faire référence aux variables expérimentales par leur nom.

Python :

```python
# Accéder à une variable expérimentale existante par son nom
print('response = ', response)
# Définir une nouvelle variable expérimentale (qui peut également être utilisée dans l'interface graphique)
new_experimental_variable = 'exemple'
```

JavaScript :

```javascript
// Accéder à une variable expérimentale existante par son nom
console.log('response = ' + response)
// Définir une nouvelle variable expérimentale (qui peut également être utilisée dans l'interface graphique)
// Remarque : Les variables définies à l'aide de `let` ne sont *pas* disponibles globalement !
var new_experimental_variable = 'exemple'
```

## Interface utilisateur améliorée

Des améliorations ont été apportées à l'interface utilisateur :

- Icônes améliorées : Les icônes d'ouverture et d'enregistrement ont été redessinées car elles étaient perçues comme peu claires par certains utilisateurs
- Les expressions conditionnelles Run-if, break-if, show-if et autres sont annotées pour plus de clarté ('Exécuter toujours')
- OSWeb apparaît désormais comme un backend
- Les éléments qui ne sont pas compatibles avec les paramètres de l'expérience sont désactivés
- Les éléments d'une expérience peuvent être désactivés. Ceci est principalement utile pour les besoins de développement, par exemple pour désactiver temporairement les instructions.
- Les messages d'erreur sont maintenant beaucoup plus informatifs.
- Une nouvelle extension de mise à jour vérifie automatiquement les mises à jour des packages sélectionnés. Cela permet de maintenir OpenSesame à jour sans avoir à télécharger et réinstaller le logiciel.


## Escalier Quest entrelacé

Les éléments `quest_staircase_init` et `quest_staircase_next` acceptent désormais un nom, ce qui vous permet d'exécuter plusieurs procédures Quest en parallèle. Ceci est principalement utile si vous souhaitez exécuter des procédures Quest indépendantes et entrelacées pour différentes conditions expérimentales.


## Sketchpad lié à mouse_response pris en charge par OSWeb

Le MOUSE_RESPONSE prend maintenant en charge les éléments SKETCHPAD liés dans OSWeb, facilitant ainsi le travail avec les régions d'intérêt dans les expériences basées sur le navigateur comme dans les expériences en laboratoire!


## Pour les développeurs : API améliorée pour les plugins et extensions

L'API des plugins et extensions a été simplifiée et révisée pour refléter les meilleures pratiques actuelles en matière de développement Python :

- %link:dev/plugin%
- %link:dev/extension%